{% load extra_tags components %}

{%for datastream in datastreams %}
    {% if datastream.sov_id %}
        <div class="dataStreamContainer clearfix">
            <div id="id_chartBox_{{datastream.id}}" class="chartBox">
                <h2 class="chartTitle"><a href="{{datastream.permalink}}" title="{{datastream.title}}" target="_blank"><span class="txt"><strong>{{datastream.title}}</strong></span></a></h2>
                <div class="chartContainer">
                	<div id="id_chartDisplay" class="chartContainerInner clearfix"></div>
                </div>
            </div>
            <script type="text/javascript">
                var lChart = $("#id_chartBox_{{datastream.id}}")[0];
                jQuery.data(lChart, "dataservice_id", "{{datastream.id}}");
                jQuery.data(lChart, "implType", '{{datastream.impl_details|escapejs}}');
                jQuery.data(lChart, "sov_id", "{{datastream.sov_id}}");
                jQuery.data(lChart, "retries", "0");
            </script>
        </div>
    {% else %}
        <!-- DATA STREAM CONTAINER -->
        <div class="dataStreamContainer clearfix">
            <!-- DATA STREAM BOX -->
            <div id="id_dataservice_container_{{datastream.id}}" class="dataStreamBox clearfix">
                <h2>
                    <a id="id_dataservice_link_{{datastream.id}}" href="{{datastream.permalink}}" target="_blank" title="{{datastream.description}}" class="clearfix">
                        {% gravatar None 78 "FL" datastream.user_nick datastream.user_email %}
                        <span class="txt">
                            <span class="titleDS"><strong>{{datastream.title}}</strong>
                            <span class="descriptionDS">{{datastream.description|truncate:"50"}}</span>
                            <span class="infoDS">
                                <span class="categoryDS">{{datastream.category_name}}</span> <span class="sep">|</span> <span class="authorDS">by <strong>{{datastream.user_nick}}</strong></span>
                            </span>
                        </span>
                    </a>
                </h2>
                <div id="id_dataservice_{{datastream.id}}"></div>

                <script type="text/javascript">
                    var lDataService = $("#id_dataservice_container_{{datastream.id}}")[0];
                    jQuery.data(lDataService, "dataservice_id", "{{datastream.id}}");
                    jQuery.data(lDataService, "dataservice_title", "{{datastream.title}}");
                    jQuery.data(lDataService, "dataservice_description", "{{datastream.description}}");
                    jQuery.data(lDataService, "user_nick", "{{datastream.user_nick}}");
                    jQuery.data(lDataService, "retries", "0");
                </script>
            </div>
        </div>
    {% endif %}
{% endfor %}
