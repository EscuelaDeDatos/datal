{% load i18n datastream_tags %}

<!-- Resource Detail -->
<div class="resource-detail box" id="id_dataStreamContainer">

		<div class="description">

			{% if dataset.mbox %}
		    <div class="row">
		        <div class="title">{% trans 'APP-TYPE-TEXT' %}</div>
				<p class="clearfix">
					<i class="icon {{ dataset.impl_type|type_classname }}"></i>{{ dataset.impl_type|type_str }} | 
					
					{% if dataset.collect_type == 0 %}
					<!-- Download -->
					<a id="id_download" href="/datasets/action_request_file?dataset_revision_id={{dataset.dataset_revision_id}}" class="link" title="{% trans 'APP-DOWNLOAD-TEXT' %}">{% trans 'APP-DOWNLOAD-TEXT' %}</a>
					
					{% elif dataset.collect_type == 1 or dataset.collect_type == 2 %}
					<!-- Go to Source -->
					<a id="id_gotosource" class="link" rel="nofollow" href="{{ dataset.end_point }}" target="_blank" title="{% trans 'APP-SOURCE-TEXT' %}">{% trans 'APP-SOURCE-TEXT' %}</a>
					{% endif %}

				</p>
		    </div>
		    {% endif %}

		    

    {{dataset.category_name}}

    <br>

    {{dataset.filename}}
    
		    <div class="row">
		        <div class="title">{% trans "APP-DESCRIPTION-TEXT" %}</div>
		        <p>{{dataset.description|capfirst}}</p>
		    </div>

		    {% if dataset.tags %}
		    <div class="row">
		        <div class="title">{% trans 'APP-TAGS-TEXT' %}</div>
		        <div class="sourcesContent">
		        {% for tag in dataset.tags %}
		            <div class="tag">
		                <span class="tagInner clearfix">
		                    <span class="tagTxt">{{tag.tag__name|capfirst}}</span>
		                </span>
		            </div>
		        {% endfor %}
		        </div>
		    </div>
		    {% endif %}

		    {% if dataset.sources %} 
		    <div class="row">
		        <div class="title">{% trans 'APP-SOURCES-TEXT' %}</div>
		        {% for source in dataset.sources %}
		        <p><a href="{{source.source__url}}" title="{{source.source__name|capfirst}}" target="_blank">{{source.source__name|capfirst}}</a></p>
		        {% endfor %}
		    </div>
		    {% endif %}

		    {% if dataset.notes %}
		    <div class="row">
		        <div class="title">{% trans 'APP-NOTES-TEXT' %}</div>
		        <p>{{dataset.notes|safe|urlize}}</p>
		    </div>
		    {% endif %}

		</div>
		
		<!-- Resources List -->
		<div class="resources-list" style="display:none;">
			<div id="id_resourcesList" class="resources-table">

				{# If impl_type is not allowed to create a Data View #}
				{% if dataset.collect_type == 0 and dataset.impl_type in datastream_impl_not_valid_choices %}

					<h4>{% trans 'APP-DATASETCANTBEUSEDTOCREATECHILD-TEXT' %}</h4>					
					{% include "viewDataset/no_resources.html" %}

				{% else %}
					{% if dataset.datastreams or dataset.visualizations %}
						<h4>{% trans 'APP-RESOURCESCREATED-TEXT' %}</h4>
						<table id='dataset_table_list'>
							<thead>
								<tr>
									<th>{% trans "APP-TITLE-TEXT" %}</th>
									<th>{% trans "APP-TYPE-TEXT" %}</th>
									<th>{% trans "APP-AUTHOR-TEXT" %}</th>
									<th>{% trans "APP-STATUS-TEXT" %}</th>
								</tr>
							</thead>
							<tbody>
							{% if dataset.datastreams %}
								{% for datastream_revision in dataset.datastreams %}
									{# Muestro solamente si es la ultima revision #}
									{% if datastream_revision.id == datastream_revision.datastream__last_revision %}
										<tr>
											<td>
												<h3><a href="{% url 'manageDataviews.view' revision_id=datastream_revision.id %}" title="{{ datastream_revision.datastreami18n__title }}">{{ datastream_revision.datastreami18n__title }}</a></h3>
												<span class="date">{% trans 'DATASET-TABLE-HEADER-MODIFIED' %}: {{ datastream_revision.modified_at|date:'F d, Y, h:i A'|capfirst }}</span>
											</td>
											<td><i class="icon-resources icon-dataview">{% trans "APP-DATASTREAM-TEXT" %}</i></td>
											<td><i class="user-thumbnail"></i>{{ datastream_revision.datastream__user__nick }}</td>
											<td>{{ datastream_revision.status|status_str }}</td>
										</tr>
									{% endif %}
								{% endfor %}
							{% endif %}
							{% if dataset.visualizations %}
								{% for visualizations_revision in dataset.visualizations %}
									{# Muestro solamente si es la ultima revision #}
									{% if visualizations_revision.id == visualizations_revision.visualization__last_revision %}
										<tr>
											<td>
												<h3><a href="{% url 'manageVisualizations.view' revision_id=visualizations_revision.id %}" title="{{ visualizations_revision.visualizationi18n__title }}">{{ visualizations_revision.visualizationi18n__title }}</a></h3>
												<span class="date">{% trans 'DATASET-TABLE-HEADER-MODIFIED' %}: {{ visualizations_revision.modified_at|date:'F d, Y, h:i A'|capfirst }}</span>
											</td>
											<td><i class="icon-resources icon-visualization">{% trans "APP-DATASTREAM-TEXT" %}</i></td>
											<td><i class="user-thumbnail"></i>{{ visualizations_revision.visualization__user__nick }}</td>
											<td>{{ visualizations_revision.status|status_str }}</td>
										</tr>
									{% endif %}
								{% endfor %}
							{% endif %}
							</tbody>
						</table>
					{% endif %}

					{% if not dataset.datastreams and not dataset.visualizations %}
						{% include "viewDataset/no_resources.html" %}
					{% endif %}

				{% endif %}

			</div>
		</div>

</div>