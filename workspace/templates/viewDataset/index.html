{% extends 'base_workspace.html' %}
{% load i18n extra_tags components dataset_tags compress staticfiles sass_tags %}

{% block meta %}
{% compress css %}
<link href="{% sass_src 'workspace/styles/detailCommon.scss' %}" type="text/css" rel="stylesheet" media="screen"/>
<link href="{% sass_src 'workspace/styles/viewDataset.scss' %}" type="text/css" rel="stylesheet" media="screen"/>
{% endcompress %}

<script type="text/javascript" src="/js_workspace/viewDataset/viewDatasetModel.js?id={{settings.VERSION_JS_CSS}}"></script>
<script type="text/javascript" src="/js_workspace/viewDataset/viewDatasetView.js?id={{settings.VERSION_JS_CSS}}"></script>
<script type="text/javascript" src="/js_workspace/viewDataset/deleteItemView.js?id={{settings.VERSION_JS_CSS}}"></script>
<script type="text/javascript" src="/js_workspace/viewDataset/affectedResourcesModel.js?id={{settings.VERSION_JS_CSS}}"></script>
<script type="text/javascript" src="/js_workspace/viewDataset/affectedResourcesView.js?id={{settings.VERSION_JS_CSS}}"></script>
<script type="text/javascript" src="/js_workspace/viewDataset/affectedResourcesCollection.js?id={{settings.VERSION_JS_CSS}}"></script>
<script type="text/javascript" src="/js_workspace/viewDataset/affectedResourcesCollectionView.js?id={{settings.VERSION_JS_CSS}}"></script>

<meta name="main-option" content="id_datasets_option"/>
{% endblock %}

{% block header_navigation %}
<!-- Back Link -->
<a href="{% url 'manageDatasets.list' %}" id="id_backLink" class="button alpha back FL" title="{% trans 'APP-BACK-TEXT' %}">{% trans 'APP-BACK-TEXT' %}</a>
{% endblock %}

{% block sectionTitle %}

<div class="context-menu clearfix">
  
  <!-- Column Left -->
  <div class="col-lg-7">    
    
    <h1>{{ dataset.title|capfirst }}</h1>

    <div class="status-row clearfix">

      {# status 5 -> Rejected #}
      {# status 6 -> Approved #}
      <span class="status {% if dataset.status == 5 %} red {% elif dataset.status == 6 %} green {% endif %}">

        {# status 3 -> Published #}
        {% if dataset.status == 3 %} 
        <span class="icon icon-inline icon-published"></span>
        {% endif %}

        <em id="id_status"></em>

      </span>

      {% if dataset.status != 3 %}
      <span class="publish-version">Última versión publicada: 30 de Septiembre de 2015, <a href="" class="link black" title="Ver en sitio">Ver en sitio</a></span>
      {% endif %}
      <span class="row-actions"><a href="" class="link black" title="Despublicar">Despublicar</a></span>
    </div>

  </div>

  <!-- Column Right -->
  <div class="col-lg-5 context-buttons clearfix">
    
    {# status 1 -> Pending review  #}
    {% if dataset.status != 1 %}

      {# If collect_type is URL or WEBSERVICE, or if impl_type is one of the allowed (for FILE), then enable "create data view" button #}
      {% if dataset.collect_type == 1 or dataset.collect_type == 2 or dataset.impl_type not in datastream_impl_not_valid_choices %}

        <!-- Main Action -->
        <a id="id_create" class="button primary FR" href="{% url 'manageDataviews.create' %}?dataset_revision_id={{ dataset.dataset_revision_id }}" title="{% trans 'APP-ACTIONS-CREATEVIEW' %}">{% trans 'APP-ACTIONS-CREATEVIEW' %}</a>

      {% endif %}
      
      <!-- Secondary Action -->
      <a href="" class="button FR" title="{% trans 'APP-PUBLISH-TEXT' %}">{% trans 'APP-PUBLISH-TEXT' %}</a>

    {% else %}

      {% if auth_manager.is_publisher or auth_manager.is_admin %}

        <!-- Accept -->
        <a id="id_approve" class="button green FR" title="{% trans 'APP-APPROVE-TEXT' %}" data-action="approve">{% trans 'APP-APPROVE-TEXT' %}</a>
        
        <!-- Reject -->
        <a id="id_reject" class="button red FR" title="{% trans 'APP-REJECT-TEXT' %}" data-action="reject">{% trans 'APP-REJECT-TEXT' %}</a>

      {% endif %}

    {% endif %}

    <!-- More Actions -->    
    <div class="more-actions button-pulldown FR" style="display:{% if dataset.status != 1 %}block{% else %}none{% endif %};">
      <div class="button more-button">
        <span class="icon icon-more"></span>
      </div>
      <ul class="dropdown" style="display:none;">
        <li id="id_edit" style="display:{% if dataset.status != 1 %}block{% else %}none{% endif %};"><a href="{% url 'manageDatasets.edit' %}/{{dataset.dataset_revision_id}}/" class="button" title="{% trans 'APP-EDIT-TEXT' %}"><span class="icon icon-edit"></span>{% trans 'APP-EDIT-TEXT' %}</a></li>
        <li id="id_delete" style="display:{% if dataset.status != 1 %}block{% else %}none{% endif %};"><a class="button red" title="{% trans 'APP-DELETE-TEXT' %}"><span class="icon icon-delete"></span>{% trans 'APP-DELETE-TEXT' %}</a></li>
      </ul>
    </div>    

  </div>

</div>







{% comment %}

<ul class="actions FR">

  {% if dataset.collect_type == 0 %}
  <!-- Download -->
  <li><a id="id_download" href="/datasets/action_request_file?dataset_revision_id={{dataset.dataset_revision_id}}" class="button small" title="{% trans 'APP-DOWNLOAD-TEXT' %}"><i class="download"></i>{% trans 'APP-DOWNLOAD-TEXT' %}</a></li>
  
  {% elif dataset.collect_type == 1 or dataset.collect_type == 2 %}
  <!-- Go to Source -->
  <li><a id="id_gotosource" class="button small" rel="nofollow" href="{{ dataset.end_point }}" target="_blank" title="{% trans 'APP-SOURCE-TEXT' %}"><i class="download"></i>{% trans 'APP-SOURCE-TEXT' %}</a></li>
  {% endif %}

</ul>

{% endcomment %}

{% endblock %}

{% block content %}
  <div class="detail" id="id_viewDataset">

    <div class="wrapper1">
      <div class="wrapper2 clearfix">
        <div class="wrapper3">

          <!-- Sidebar -->
          <section class="sidebar-container">

            {% include "viewDataset/sidebar.html" %}

          </section>

          <!-- Detail -->
          <section class="detail-container">

            {% include "viewDataset/detail.html" %}

          </section>

        </div>
      </div>
    </div>
  </div>
{% endblock %}

{% block bottom_js %}
<script type="text/javascript">
$(document).ready(function(){
  var viewDatasetModel = new ViewDatasetModel({
    reviewURL: "{% url 'manageDatasets.review' dataset.dataset_revision_id %}",
    status: "{{ dataset.status|status_str|capfirst }}",
    id: "{{ dataset.last_revision_id }}",
    dataset_id: " {{ dataset.dataset_id }}",
    title: "{{ dataset.title }}"
  });
  var viewDatasetView = new ViewDatasetView({model: viewDatasetModel});
});
</script>
{% endblock %}

{% block popupsOverlay %}
  {% include "viewDataset/overlays.html" %}
{% endblock %}